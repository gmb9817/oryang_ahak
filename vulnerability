4

# Vulnerability Analysis Report

This report details potential security vulnerabilities found in the Oryang Ahak web application.

## 1. Hardcoded Secrets

- **Vulnerability**: The Flask `app.secret_key` is generated with `os.urandom(24)` which means it changes every time the application restarts. This will invalidate all user sessions on every restart. While not a vulnerability in itself, it's a bad practice. More importantly, the Google OAuth `client_id` and `client_secret` are hardcoded directly into `app.py`.
- **File**: `app.py`
- **Lines**:
  - `app.secret_key = os.urandom(24)`
  - `client_id='960249686982-a99ao2kso93e6d2fhr97gkrlqho8l0kb.apps.googleusercontent.com'`
  - `client_secret='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'`
  - `dictionary_api_key = '7E98638BB1A1278BE9FB408A95D9DF34'`
- **Risk**: High. If the source code is ever leaked or made public, these credentials will be compromised, allowing unauthorized access to the Google project and the dictionary API.
- **Recommendation**: Store secrets in environment variables or a dedicated configuration file (e.g., `.env`) that is not committed to version control. Use a library like `python-dotenv` to load them into the application.

## 2. No CSRF Protection on Forms

- **Vulnerability**: Several forms and POST endpoints do not have Cross-Site Request Forgery (CSRF) protection. An attacker could trick a logged-in user (especially an admin) into clicking a malicious link that submits a form on their behalf.
- **Affected Endpoints**:
  - `/signup` (POST)
  - `/game/acid/score` (POST)
  - `/game/consonant/score` (POST)
  - `/game/goldbell/save-quiz` (POST, High Risk for admins)
  - `/game/goldbell/start` (POST, High Risk for admins)
  - `/column/new` (POST, High Risk for admins)
  - `/column/submit` (POST)
  - `/game/goldbell/join` (POST)
  - `/game/goldbell/submit/<game_code>` (POST)
- **Risk**: Medium to High. An attacker could create a new column, create a new quiz, or submit game scores on behalf of a user.
- **Recommendation**: Implement CSRF protection. The `Flask-WTF` library is a common and effective way to add CSRF tokens to forms. For AJAX/fetch requests, the CSRF token can be passed in a custom header.

## 3. Potential for Stored Cross-Site Scripting (XSS)

- **Vulnerability**: When creating new columns (`/column/new`) or new quiz sets (`/game/goldbell/save-quiz`), the application takes user input (title, content, question text, etc.) and writes it directly into Python source files (`.py`). These Python files are later imported and the data is rendered in templates. While Jinja2 auto-escapes by default, the process of writing code from user input is extremely dangerous. A sophisticated attacker could potentially inject malicious code that breaks out of the string literals and executes on the server (Remote Code Execution) or injects malicious HTML/JavaScript that gets rendered to other users.
- **File**: `app.py`
- **Functions**: `column_create`, `save_quiz`
- **Example**: In `column_create`, `safe_title = title.replace('"', '\\"')` is insufficient sanitization. An attacker could use other characters or sequences to manipulate the generated Python code. The same applies to `save_quiz`.
- **Risk**: Critical. This could lead to Remote Code Execution (RCE) on the server or persistent XSS affecting all users who view the content.
- **Recommendation**: **Do not generate `.py` files from user input.** Instead of storing content and quizzes as Python modules, store them in a database or as plain JSON/Markdown files. Then, read these data files at runtime. This separates data from code and is a much safer design pattern.

## 4. Insecure Direct Object Reference (IDOR) / Path Traversal

- **Vulnerability**: The `/column/<column_id>` route takes a `column_id` and uses it to construct a file path: `os.path.join(columns_dir, f'{column_id}.py')`. The `column_id` comes directly from the URL. While the application seems to generate safe IDs, there is no validation on the `column_id` parameter itself. An attacker could manipulate this parameter with path traversal characters (like `..%2F` or `..\\`) to read arbitrary `.py` files on the server's file system.
- **File**: `app.py`
- **Route**: `/column/<column_id>`
- **Risk**: Medium. An attacker could potentially read the source code of other Python files, including `app.py`, which contains hardcoded secrets.
- **Recommendation**: Sanitize the `column_id` parameter before using it in a file path. Ensure it only contains alphanumeric characters, underscores, and hyphens. A simple way is to use a regex check: `if not re.match(r'^[a-zA-Z0-9_-]+$', column_id): return "Invalid ID", 400`. The same logic should be applied to the `quiz_id` in `/game/goldbell/start`. The best fix is to stop using filesystem-as-a-database (see point 3).

## 5. Insecure Use of `requests` with `verify=False`

- **Vulnerability**: The `/search` route makes an external API call to `stdict.korean.go.kr` using `requests.get(..., verify=False)`. This disables SSL/TLS certificate validation, making the connection vulnerable to Man-in-the-Middle (MITM) attacks.
- **File**: `app.py`
- **Route**: `/search`
- **Risk**: Low to Medium. An attacker on the same network could intercept the traffic, read the search query and the API key, and even modify the dictionary results returned to the user.
- **Recommendation**: Remove `verify=False` and ensure the system's trust store is up to date to handle the certificate validation correctly. If there's a specific certificate issue, the certificate bundle should be updated or specified, rather than disabling verification entirely.

## 6. Sensitive Information in JSON Files

- **Vulnerability**: User profiles, which include names and points, are stored in `user_profiles.json`. Ranking data is in `ranking.json` and `ranking_consonant.json`. If the web server is misconfigured to serve JSON files from the root directory, this sensitive information could be publicly accessible.
- **Files**: `user_profiles.json`, `ranking.json`, `ranking_consonant.json`
- **Risk**: Low. This is contingent on a server misconfiguration, but it's bad practice to store sensitive data in the web root.
- **Recommendation**: Store these data files outside of the web root directory so they cannot be accessed via a URL. For example, place them in a `data/` directory that is at the same level as the `app.py` file, but not served by Flask.

## 7. Denial of Service (DoS) via In-Memory Storage

- **Vulnerability**: The `game_sessions` dictionary is stored in memory and never cleared. A malicious actor could repeatedly call the `/game/goldbell/start` endpoint (if they are an admin) or `/game/goldbell/join` to create a large number of game sessions and add players, consuming server memory until it crashes.
- **File**: `app.py`
- **Object**: `game_sessions`
- **Risk**: Medium. Can lead to a denial of service.
- **Recommendation**: Implement a cleanup mechanism for old or inactive game sessions. A background thread or a scheduled task could periodically iterate through `game_sessions` and remove any game that was created more than a certain time ago (e.g., 24 hours). Also, limit the number of active games an admin can create.
